/* ============================================
   EMBEDDED MODE STYLES FOR TIBOK IFRAME
   ============================================ */

/* Mode embedded : enlever marges/padding */
body.embedded-mode {
  margin: 0 !important;
  padding: 0 !important;
  overflow-y: auto;
  overflow-x: hidden;
  
  /* Smooth scroll sur mobile */
  -webkit-overflow-scrolling: touch;
  
  /* Pas de s√©lection de texte accidentelle */
  -webkit-user-select: text;
  user-select: text;
  
  /* Background blanc pour l'iframe */
  background: white !important;
}

/* Cacher header/footer/navbar en mode embedded */
body.embedded-mode header,
body.embedded-mode footer,
body.embedded-mode .main-header,
body.embedded-mode .main-footer,
body.embedded-mode .navbar,
body.embedded-mode .top-bar,
body.embedded-mode nav:first-child {
  display: none !important;
  visibility: hidden !important;
  height: 0 !important;
  overflow: hidden !important;
  opacity: 0 !important;
}

/* Contenu prend toute la hauteur */
body.embedded-mode main,
body.embedded-mode .embedded-content {
  min-height: 100vh;
  padding: 0.5rem;
  background: white;
  width: 100%;
  max-width: 100%;
}

/* Optimisations mobile en iframe */
@media (max-width: 1024px) {
  body.embedded-mode {
    /* Pas de zoom sur input focus (iOS fix) */
    font-size: 16px;
  }
  
  body.embedded-mode main,
  body.embedded-mode .embedded-content {
    padding: 0.5rem;
  }
  
  /* Inputs plus grands pour touch */
  body.embedded-mode input,
  body.embedded-mode textarea,
  body.embedded-mode select {
    min-height: 44px;
    font-size: 16px;
  }
  
  /* Boutons touch-friendly */
  body.embedded-mode button {
    min-height: 44px;
    min-width: 44px;
  }
}

/* Fix scrolling issues */
body.embedded-mode * {
  box-sizing: border-box;
}

/* D√©sactiver animations lourdes en iframe pour performance */
body.embedded-mode * {
  animation-duration: 0.2s !important;
  transition-duration: 0.2s !important;
}

/* Optimisations suppl√©mentaires pour iframe */
body.embedded-mode {
  /* Pas de pull-to-refresh sur mobile */
  overscroll-behavior: contain;
  
  /* Meilleure performance scrolling */
  scroll-behavior: smooth;
}

/* Fix pour les modals/dialogs en embedded */
body.embedded-mode .modal,
body.embedded-mode .dialog,
body.embedded-mode [role="dialog"] {
  position: fixed !important;
  z-index: 9999 !important;
}

/* Assurer que le contenu principal est visible */
body.embedded-mode > div:first-child {
  min-height: 100vh;
}

/* Fix pour les tooltips en embedded */
body.embedded-mode [data-tooltip],
body.embedded-mode [role="tooltip"] {
  z-index: 10000 !important;
}

/* Performance: d√©sactiver certaines animations en embedded */
@media (prefers-reduced-motion: reduce) {
  body.embedded-mode * {
    animation: none !important;
    transition: none !important;
  }
}

/* Debug mode (optionnel) */
body.embedded-mode.debug-mode::before {
  content: "üéØ EMBEDDED MODE ACTIVE";
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: #4CAF50;
  color: white;
  text-align: center;
  padding: 4px;
  font-size: 12px;
  z-index: 99999;
  font-weight: bold;
}

/* ============================================
   MOBILE OPTIMIZATIONS (ENHANCED)
   ============================================ */

/* Mobile: r√©duire padding global */
@media (max-width: 768px) {
  body.embedded-mode {
    padding: 0 !important;
  }
  
  body.embedded-mode main,
  body.embedded-mode .embedded-content {
    padding: 0.25rem !important;
  }
  
  /* Cards plus compactes sur mobile */
  body.embedded-mode .card,
  body.embedded-mode [class*="card"] {
    margin-bottom: 0.5rem !important;
  }
  
  /* Textes plus petits sur mobile pour √©conomiser l'espace */
  body.embedded-mode h1 {
    font-size: 1.5rem !important;
  }
  
  body.embedded-mode h2 {
    font-size: 1.25rem !important;
  }
  
  body.embedded-mode h3 {
    font-size: 1.1rem !important;
  }
  
  body.embedded-mode p,
  body.embedded-mode label {
    font-size: 0.9rem !important;
  }
  
  /* Formulaires optimis√©s mobile */
  body.embedded-mode form {
    width: 100% !important;
  }
  
  body.embedded-mode input,
  body.embedded-mode textarea,
  body.embedded-mode select {
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* Grilles responsive: 1 colonne sur mobile */
  body.embedded-mode .grid,
  body.embedded-mode [class*="grid"] {
    grid-template-columns: 1fr !important;
    gap: 0.5rem !important;
  }
  
  /* Flex items: ONLY stack certain containers vertically, NOT all flex elements */
  /* Remove the aggressive flex-direction: column rule that was breaking layouts */
  /* Specific containers that should stack can use explicit classes like flex-col */

  /* Removed aggressive button width rule that was breaking allergy/checkbox buttons */
  /* Only apply full-width to specific action buttons, not all buttons */

  /* Progress bar visible sur mobile */
  body.embedded-mode .progress,
  body.embedded-mode [role="progressbar"] {
    width: 100% !important;
    margin-bottom: 1rem !important;
  }
  
  /* Tabs responsive */
  body.embedded-mode [role="tablist"] {
    flex-wrap: wrap !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
  
  body.embedded-mode [role="tab"] {
    font-size: 0.85rem !important;
    padding: 0.5rem !important;
  }
}

/* Tr√®s petit √©cran (‚â§480px) */
@media (max-width: 480px) {
  body.embedded-mode {
    font-size: 14px !important;
  }
  
  body.embedded-mode main,
  body.embedded-mode .embedded-content {
    padding: 0.25rem !important;
  }
  
  body.embedded-mode h1 {
    font-size: 1.25rem !important;
  }
  
  body.embedded-mode h2 {
    font-size: 1.1rem !important;
  }
  
  body.embedded-mode h3 {
    font-size: 1rem !important;
  }
  
  body.embedded-mode p,
  body.embedded-mode label {
    font-size: 0.85rem !important;
  }
  
  /* Badges plus petits */
  body.embedded-mode .badge,
  body.embedded-mode [class*="badge"] {
    font-size: 0.7rem !important;
    padding: 0.25rem 0.5rem !important;
  }
}

/* Fix pour les containers qui d√©bordent */
body.embedded-mode * {
  max-width: 100% !important;
}

body.embedded-mode img,
body.embedded-mode video {
  max-width: 100% !important;
  height: auto !important;
}

/* Container principal prend toute la largeur en embedded */
body.embedded-mode .container,
body.embedded-mode [class*="container"] {
  max-width: 100% !important;
  width: 100% !important;
  padding-left: 0.5rem !important;
  padding-right: 0.5rem !important;
}

/* Fix pour les modals en mode mobile */
@media (max-width: 768px) {
  body.embedded-mode .modal,
  body.embedded-mode .dialog,
  body.embedded-mode [role="dialog"] {
    width: 95vw !important;
    max-width: 95vw !important;
    margin: 0.5rem !important;
  }
}

/* Optimiser les tables pour mobile */
@media (max-width: 768px) {
  body.embedded-mode table {
    display: block !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
  }
  
  body.embedded-mode thead {
    display: none !important;
  }
  
  body.embedded-mode tbody,
  body.embedded-mode tr,
  body.embedded-mode td {
    display: block !important;
    width: 100% !important;
  }
  
  body.embedded-mode tr {
    margin-bottom: 1rem !important;
    border: 1px solid #e5e7eb !important;
    border-radius: 0.5rem !important;
    padding: 0.5rem !important;
  }
  
  body.embedded-mode td {
    text-align: left !important;
    padding: 0.25rem !important;
  }
  
  body.embedded-mode td::before {
    content: attr(data-label) ": " !important;
    font-weight: bold !important;
  }
}
